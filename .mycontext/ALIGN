# MyContext Alignment Guard [SYNC]
Any changes to code, architecture, or features MUST be synchronized with:
1. `.mycontext/context.json` (Source of Truth / Living Brain)
2. `README.md` (Human-facing orientation & usage)

[AI INSTRUCTION]:
- You are an orchestrator of the Living Brain.
- "Guessing" is prohibited. Align with the user's intent by clarifying requirements first.
- If you cannot directly edit these files, output structured JSON/Markdown snippets for the user to apply.

[PHILOSOPHY: DETERMINISTIC SCAFFOLDING]:
- **Next.js + InstantDB First**: We are built for Next.js full-stack projects using InstantDB as the backend.
- **Mega Context (100% Knowledge)**:
  - Before ANY code is generated, the `MegaContext` (a comprehensive JSON state) must be 100% populated.
  - This includes: `Routes`, `Users/Permissions`, `Pages`, `Server Actions`, `Client Components`, `Database Schema`.
  - It does NOT matter if the user has to answer 100 questions. The goal is certainty.
  - Once `MegaContext` is complete, the scaffolding script runs purely on facts, not hallucinations.

[AGENT TEAMS ARCHITECTURE]:
- The "Living Brain" (`context.json`) is the shared state ("Blackboard") that enables scalable Agent Teams.
- Agents do not message each other directly; they communicate by reading and writing to this shared state.
- ALWAYS check `context.json` for the latest state before acting. ALWAYS update `context.json` with your results.

[FRACTAL ARCHITECTURE]:
- **Recursive Decomposition (Top-Down)**: The `ProblemSolver` agent breaks large problems into smaller sub-problems until they reach a "Definite Behavior" or "Atomic UX Flow".
  - STOP condition: The task is small enough to be executed with 100% confidence.
  - **Nuance [UI]**: For user interfaces, a single ShadCN component or a logical group of them is considered atomic.
- **Atomic Assembly (Bottom-Up)**: The `Builder` agent constructs atomic components first, then assembles them into molecules.

[LEGO ASSEMBLY]:
- **Component Registry**: Every component generated is stored in the `Living DB` (part of `context.json` / `MegaContext`).
- **Semantic Retrieval**: Before generating a new component, agents search the registry for "Relevant Pieces".
- **Lego Prompting**: "Assemble these [Pieces] and add [New Behavior]". Ensure visual and logical consistency.

[UNIFIED CONTEXT SCHEMA]:
- `context.json` supports two complementary shapes that can coexist:
  - **MegaContext**: Typed, structured fields for deterministic scaffolding (`database.entities`, `routing.routes`, `auth.roles`)
  - **Brain**: Narrative, registry, checkpoints, memory for existing/scanned projects (`brain.narrative`, `brain.registry`, `brain.checkpoints`)
- The `UnifiedContext` type in `types/unified-context.ts` bridges both schemas.
- `getContextSummary()` extracts data from either shape; `isMegaContext()` / `isBrainContext()` detect which fields are populated.

[PROJECT SCANNER â€” CONTEXT SYNC]:
- **File Tree Scanning**: `mycontext scan` walks the real project file tree (respecting .gitignore) and reads key files.
- **LLM Assessment**: `mycontext scan --assess` compares ACTUAL code against PLANNED context.json via LLM.
- **Context Drift Detection**: Identifies routes/components/entities that exist in code but not in context, or vice versa.
- **Deep Merge**: Uses `deepMerge()` â€” recursive merge with array dedup by name/id â€” to safely update context without data loss.
- **TUI Integration**: PlanningMode's "ðŸ“‚ Scan & Assess" option runs this automatically during refinement.

[CONTEXT SYNCER â€” SELF-RECONTEXTUALIZATION]:
- `mycontext sync` autonomously updates `context.json` and `README.md`:
  1. Scans real file tree via `ProjectScanner`
  2. LLM assesses drift and generates `ContextDiffReport`
  3. Deep merges suggestions into `context.json`
  4. LLM generates README content between `<!-- mycontext:start -->` / `<!-- mycontext:end -->` markers
- Supports `--dry-run`, `--context`, `--readme` flags.

[DOCTOR â€” HEALTH & DIAGNOSTICS]:
- `mycontext doctor` ensures project health and configuration correctness.
- **Auto-Fix First**: Detects issues in Next.js, Turborepo, Node.js, and Dead Code, then auto-fixes them where possible.
- **Grading System**: Assigns a letter grade (A+ to F) based on diagnostics.
- **Monorepo Aware**: Understands Turborepo structure and runs specific rules for root vs. workspaces.


[TUI MODES]:
- **Planning Mode**: Chat with the user to build the `MegaContext`. If existing project is detected, offers **Auto-Init** with AI narrative generation.
- **Agent Mode**: Execute tasks (file creation, command running) based on `MegaContext`.
- **Auto-Edit Mode**: Watch file changes or run specific refactors.
